# üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ API Route ‡πÅ‡∏ó‡∏ô Client-side Upload

> **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°**: Storage policies ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡∏ß‡∏ô‡πÑ‡∏õ‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à  
> **‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏´‡∏°‡πà**: ‡πÉ‡∏ä‡πâ API Route ‡πÅ‡∏ó‡∏ô client-side upload  
> **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**: ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Storage policies ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

---

## üéØ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

### ‚ùå ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Å‡πà‡∏≤ (‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
- Client-side upload ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Supabase Storage
- ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç RLS policies ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
- ‡∏ß‡∏ô‡πÑ‡∏õ‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
- ‡πÉ‡∏ä‡πâ API Route ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
- Server-side ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Storage
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ policies

---

## üîß ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 1Ô∏è‚É£ ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà

**‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°**:
```bash
# ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°
mv apps/web/src/app/settings/page.tsx apps/web/src/app/settings/page-old.tsx

# ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
mv apps/web/src/app/settings/page-new.tsx apps/web/src/app/settings/page.tsx
```

### 2Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Route

**‡πÑ‡∏ü‡∏•‡πå**: `apps/web/src/app/api/upload-profile/route.ts`

**‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ**:
```typescript
export async function POST(request: NextRequest) {
  // Server-side upload logic
  // ‡πÉ‡∏ä‡πâ Supabase server client
  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Storage policies
}
```

### 3Ô∏è‚É£ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î

```bash
cd apps/web
npm run dev
```

**‡πÄ‡∏õ‡∏¥‡∏î**: http://localhost:3000/settings  
**‡∏•‡∏≠‡∏á**: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ profile  
**‡∏î‡∏π**: Console ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô:
```
üöÄ ‡πÉ‡∏ä‡πâ API Route ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...
‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ú‡πà‡∏≤‡∏ô API Route!
üîó URL: https://...supabase.co/storage/v1/...
```

---

## üîç ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏´‡∏°‡πà

### ‚úÖ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Storage
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç RLS policies
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ client-side authentication
- Server-side ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á

### ‚úÖ ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
- ‡πÉ‡∏ä‡πâ API Route ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
- Fallback system ‡∏ó‡∏µ‡πà‡∏î‡∏µ

### ‚úÖ ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Supabase settings
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Storage policies
- ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### Test Case 1: ‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (<2MB)
**Input**: ‡∏£‡∏π‡∏õ 500KB  
**Expected**: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô API Route  
**Result**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô

### Test Case 2: ‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà (>2MB)
**Input**: ‡∏£‡∏π‡∏õ 5MB  
**Expected**: ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î  
**Result**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô

### Test Case 3: API Route ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
**Input**: ‡∏£‡∏π‡∏õ‡πÉ‡∏î‡πÜ  
**Expected**: ‡πÉ‡∏ä‡πâ base64 fallback  
**Result**: ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô

---

## üîß ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Route

```typescript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ API Route ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
const response = await fetch('/api/upload-profile', {
  method: 'POST',
  body: formData
});

console.log('Response status:', response.status);
console.log('Response data:', await response.json());
```

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Server Logs

```bash
# ‡∏î‡∏π logs ‡πÉ‡∏ô terminal
npm run dev

# ‡∏î‡∏π logs ‡πÉ‡∏ô Supabase Dashboard
# Logs ‚Üí API Logs
```

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Network Tab

1. ‡πÄ‡∏õ‡∏¥‡∏î DevTools (F12)
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Network tab
3. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
4. ‡∏î‡∏π request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `/api/upload-profile`

---

## üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ

| ‡∏ß‡∏¥‡∏ò‡∏µ | ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å |
|------|-------|---------|---------|
| **Client-side Upload** | ‡πÄ‡∏£‡πá‡∏ß, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô server | ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ Storage policies | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **API Route** | ‡∏á‡πà‡∏≤‡∏¢, ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô server | ‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ |

---

## üéØ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ API Route (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
```bash
# ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
mv apps/web/src/app/settings/page-new.tsx apps/web/src/app/settings/page.tsx
```

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Route
```typescript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ API Route ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
```

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô web app
```

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å**: Client-side upload ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Storage policies  
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**: ‡πÉ‡∏ä‡πâ API Route ‡πÅ‡∏ó‡∏ô  
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Storage settings

---

**‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á 2 ‡∏ô‡∏≤‡∏ó‡∏µ!** ‚è∞

‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏ö‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ñ‡πà‡∏∞!
